/* Autogenerated with Kurento Idl */

#include <memory>

#include "MediaPipeline.hpp"
#include "MediaProfileSpecType.hpp"
#include "HttpGetEndpoint.hpp"
#include <JsonSerializer.hpp>

namespace kurento {

std::shared_ptr<MediaObject> HttpGetEndpoint::Factory::createObject (const Json::Value &params)
{
  std::shared_ptr<MediaPipeline> mediaPipeline;
  bool terminateOnEOS = false;
  std::shared_ptr<MediaProfileSpecType> mediaProfile;
  int disconnectionTimeout = 0;
  int garbagePeriod = 0;

  if (!params.isMember ("mediaPipeline")) {
    /* param 'mediaPipeline' not present, raise exception */
    JsonRpc::CallException e (JsonRpc::ErrorCode::SERVER_ERROR_INIT,
                              "'mediaPipeline' parameter is requiered");
    throw e;
  } else {
    JsonSerializer s(false);
    s.JsonValue = params;
    s.SerializeNVP(mediaPipeline);
  }

  if (!params.isMember ("terminateOnEOS")) {
    /* param 'terminateOnEOS' not present, using default */
    terminateOnEOS = false;
  } else {
    JsonSerializer s(false);
    s.JsonValue = params;
    s.SerializeNVP(terminateOnEOS);
  }

  if (!params.isMember ("mediaProfile")) {
    /* param 'mediaProfile' not present, using default */
    mediaProfile = std::shared_ptr<MediaProfileSpecType> (new MediaProfileSpecType ("WEBM"));
  } else {
    JsonSerializer s(false);
    s.JsonValue = params;
    s.SerializeNVP(mediaProfile);
  }

  if (!params.isMember ("disconnectionTimeout")) {
    /* param 'disconnectionTimeout' not present, using default */
    disconnectionTimeout = 2;
  } else {
    JsonSerializer s(false);
    s.JsonValue = params;
    s.SerializeNVP(disconnectionTimeout);
  }

  if (!params.isMember ("garbagePeriod")) {
    /* param 'garbagePeriod' not present, using default */
    garbagePeriod = 120;
  } else {
    JsonSerializer s(false);
    s.JsonValue = params;
    s.SerializeNVP(garbagePeriod);
  }

  return createObject (mediaPipeline, terminateOnEOS, mediaProfile, disconnectionTimeout, garbagePeriod);
}

HttpGetEndpoint::Factory::StaticConstructor HttpGetEndpoint::Factory::staticConstructor;

HttpGetEndpoint::Factory::StaticConstructor::StaticConstructor()
{
  if (objectRegistrar) {
    std::shared_ptr <Factory> factory (new HttpGetEndpoint::Factory());

    objectRegistrar->registerFactory(factory);
  }
}

void
HttpGetEndpoint::Invoker::invoke (std::shared_ptr<MediaObject> obj,
    const std::string &methodName, const Json::Value &params,
    Json::Value &response)
{
  HttpEndpoint::Invoker::invoke(obj, methodName, params, response);
}

std::string
HttpGetEndpoint::connect(const std::string &eventType, std::shared_ptr<EventHandler> handler)
{
  return HttpEndpoint::connect (eventType, handler);
}

} /* kurento */

void
Serialize(std::shared_ptr<kurento::HttpGetEndpoint> &object, JsonSerializer &serializer)
{
  if (!serializer.IsWriter) {
    try {
      std::shared_ptr<kurento::MediaObject> aux;
      aux = kurento::HttpGetEndpoint::Factory::getObject (serializer.JsonValue.asString ());
      object = std::dynamic_pointer_cast<kurento::HttpGetEndpoint> (aux);
      return;
    } catch (kurento::JsonRpc::CallException &ex) {
      kurento::JsonRpc::CallException e (kurento::JsonRpc::ErrorCode::SERVER_ERROR_INIT,
                              "'HttpGetEndpoint' object not found: "+ ex.getMessage());
      throw e;
    }
  }
  std::shared_ptr<kurento::HttpEndpoint> aux = std::dynamic_pointer_cast<kurento::HttpEndpoint> (object);

  void Serialize(std::shared_ptr<kurento::HttpEndpoint> &object, JsonSerializer &serializer);
  Serialize(aux, serializer);
}

void
Serialize(kurento::HttpGetEndpoint &object, JsonSerializer &serializer)
{
  void Serialize(kurento::HttpEndpoint &object, JsonSerializer &serializer);
  try {
    Serialize(dynamic_cast<kurento::HttpEndpoint &> (object), serializer);
  } catch (std::bad_cast) {
  }
}
